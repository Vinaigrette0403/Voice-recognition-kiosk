<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í‚¤ì˜¤ìŠ¤í¬ ë©”ë‰´</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      background-color: #f2f2f2;
    }
    .menu-container {
      width: 70%;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .menu-item {
      background: white;
      width: 220px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      padding: 15px;
      text-align: center;
    }
    .menu-item img {
      width: 200px;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
    }

    .qty-btn {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 5px 10px;
      margin: 0 2px;
      border-radius: 5px;
      cursor: pointer;
    }
    .delete-btn {
      background-color: #f44336;  /* ë¹¨ê°„ìƒ‰ */
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    #cart {
      width: 30%;
      background-color: #fff;
      border-left: 2px solid #ddd;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }
    #cart h2 {
      text-align: left;
    }
    #cart-items {
      flex: 1;
      overflow-y: auto;
      text-align: left;
    }
    #cart-items li {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    #checkout-btn {
      background-color: #4caf50;
      color: white;
      padding: 20px;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }
    .option-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
    }
    .option-content {
      background-color: #ffffff;
      width: 600px;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      font-size: 24px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    .option-content button {
     width: 45%;
     padding: 20px 0;
     font-size: 20px;
     margin: 20px 10px 0 10px;
     border-radius: 15px;
     border: none;
     cursor: pointer;
    font-weight: bold;
    }

    .option-section {
      margin: 20px 0;
    }
    .options label {
      display: inline-block;
      margin: 10px;
      padding: 20px 40px;
      border: 2px solid #ccc;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
    }
    .options input {
      display: none;
    }
    .options input:checked + label {
      border-color: #007bff;
      background-color: #e3f2fd;
    }
  
#voice-button {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px;
}
#voice-button img {
  width: 80px;
  height: 80px;
}

</style>
</head>
<body>
  <div class="menu-container">
    <div class="menu-item" onclick="openOptionModal('ì•„ë©”ë¦¬ì¹´ë…¸', 2000)">
      <img src="{{ url_for('static', filename='images/americano.jpg') }}" />
      <h3>ì•„ë©”ë¦¬ì¹´ë…¸(2,000ì›)</h3>
    </div>

    <div class="menu-item" onclick="openOptionModal('ì¹´í˜ë¼ë–¼', 3000)">
      <img src="{{ url_for('static', filename='images/latte.jpg') }}" />
      <h3>ì¹´í˜ë¼ë–¼(3,000ì›)</h3>
    </div>

    <div class="menu-item" onclick="openOptionModal('ì´ˆì½”ë¼ë–¼',4500)">
      <img src="{{ url_for('static', filename='images/choco.jpeg') }}">
      <h3>ì´ˆì½”ë¼ë–¼(4,500ì›)</h3>
    </div>

    <div class="menu-item" onclick="openOptionModal('ì•„ì´ìŠ¤í‹°',3000)">
      <img src="{{ url_for('static', filename='images/icetea.jpg') }}">
      <h3>ì•„ì´ìŠ¤í‹°(3,000ì›)</h3>
    </div>

    <div class="menu-item" onclick="openOptionModal('ë…¹ì°¨ë¼ë–¼',4000)">
      <img src="{{ url_for('static', filename='images/green.png') }}">
      <h3>ë…¹ì°¨ë¼ë–¼(4,000ì›)</h3>
    </div>

    <div class="menu-item" onclick="openOptionModal('ë”¸ê¸°ë¼ë–¼',5000)">
      <img src="{{ url_for('static', filename='images/strawberry.jpg') }}">
      <h3>ë”¸ê¸°ë¼ë–¼(5,000ì›)</h3>
    </div>

    <div class="menu-item" onclick="openOptionModal('ë°”ë‹ë¼ë¼ë–¼',3500)">
      <img src="{{ url_for('static', filename='images/vanilla.png') }}">
      <h3>ë°”ë‹ë¼ë¼ë–¼(3,500ì›)</h3>
    </div>

    <!-- ğŸ”½ ë””ì €íŠ¸ 3ê°œ: ìŒë£Œë‘ ë˜‘ê°™ì€ ë””ìì¸ + ë°”ë¡œ ì¥ë°”êµ¬ë‹ˆ -->
    <div class="menu-item" onclick="addDessert('ì¹˜ì¦ˆì¼€ì´í¬', 4500)">
      <img src="{{ url_for('static', filename='images/cheesecake.jpg') }}" />
      <h3>ì¹˜ì¦ˆì¼€ì´í¬(4,500ì›)</h3>
    </div>

    <div class="menu-item" onclick="addDessert('ì™€í”Œ', 4000)">
      <img src="{{ url_for('static', filename='images/waffle.jpg') }}" />
      <h3>ì™€í”Œ(4,000ì›)</h3>
    </div>

    <div class="menu-item" onclick="addDessert('ìƒŒë“œìœ„ì¹˜', 5000)">
      <img src="{{ url_for('static', filename='images/sandwich.jpg') }}" />
      <h3>ìƒŒë“œìœ„ì¹˜(5,000ì›)</h3>
    </div>
  </div>

  <div id="cart">
    <h2>ì¥ë°”êµ¬ë‹ˆ</h2>

  
  <button id="voice-button" onclick="startVoiceOrder()">
    <img src="{{ url_for('static', filename='images/mic.png') }}" alt="ìŒì„± ì£¼ë¬¸" />
  </button>


    <ul id="cart-items"></ul>
    <p>ì´ì•¡: <span id="total">0</span>ì›</p>
    <button id="checkout-btn" onclick="checkout()">ê²°ì œí•˜ê¸°</button>
  </div>

  <div class="option-modal" id="optionModal">
    <div class="option-content">
      <h2 id="optionTitle"></h2>
      <p>ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>

      <div class="option-section">
         <h3>ì˜¨ë„ <span style="color: red; font-size: 0.8em;">(í•„ìˆ˜ ì„ íƒ)</span></h3>
        <div class="options">
          <input type="radio" id="ice" name="temp" value="ICE" /><label for="ice">ICE</label>
          <input type="radio" id="hot" name="temp" value="HOT" /><label for="hot">HOT</label>
        </div>
      </div>
      <div class="option-section" id="requests">
        <h3>ìš”ì²­ì‚¬í•­</h3>
        <div class="options">
          <input type="checkbox" id="req1" class="req-option" value="ì—†ìŒ" checked><label for="req1">ì—†ìŒ</label>
          <input type="checkbox" id="req2" class="req-option" value="ì–¼ìŒ ì ê²Œ"><label for="req2">ì–¼ìŒ ì ê²Œ</label>
          <input type="checkbox" id="req3" class="req-option" value="ì—°í•˜ê²Œ"><label for="req3">ì—°í•˜ê²Œ</label>
        </div>
      </div>

      <div class="option-section" id="adds">
        <h3>ì¶”ê°€ ì˜µì…˜ (+500ì›)</h3>
        <div class="options">
          <input type="checkbox" id="add1" class="add-option" value="ì—†ìŒ" data-price="0" checked><label for="add1">ì—†ìŒ</label>
          <input type="checkbox" id="add2" class="add-option" data-price="500"><label for="add2">ìƒ· ì¶”ê°€</label>
          <input type="checkbox" id="add3" class="add-option" data-price="500"><label for="add3">íœ˜í•‘ ì¶”ê°€</label>
          <input type="checkbox" id="add4" class="add-option" data-price="500"><label for="add4">ë°”ë‹ë¼ ì‹œëŸ½</label>
        </div>
      </div>

      <button onclick="addToCart()">ì£¼ë¬¸ë‹´ê¸°</button>
      <button onclick="playVoice('ì£¼ë¬¸ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤');closeOptionModal();">ì·¨ì†Œ</button>
    </div>
  </div>
<script>
  let selectedItem = { name: '', price: 0 };

  function openOptionModal(name, price) {
    selectedItem = { name, price };
    document.getElementById('optionTitle').innerText = name;
    document.querySelectorAll('input').forEach(input => input.checked = false);
    document.querySelector('#req1').checked = true;
    document.querySelector('#add1').checked = true;
    document.getElementById('optionModal').style.display = 'flex';
    
    const audio = new Audio(`/speak/${encodeURIComponent(name)}`);
    audio.play();

    const hotInput = document.querySelector("#hot");
    const hotLabel = document.querySelector("label[for='hot']");

    const iceOnlyItems = ['ë”¸ê¸°ë¼ë–¼','ì•„ì´ìŠ¤í‹°'];  // ICE ì „ìš© ìŒë£Œë“¤

    if (iceOnlyItems.includes(name)) {
        hotInput.style.visibility = "hidden";
        hotInput.style.position = "absolute";
        hotLabel.style.visibility = "hidden";
        hotLabel.style.position = "absolute";
        hotInput.checked = false;
    } else {
         hotInput.style.visibility = "visible";
        hotInput.style.position = "static";
        hotLabel.style.visibility = "visible";
        hotLabel.style.position = "static";
    }
  }

  function closeOptionModal() {
    document.getElementById('optionModal').style.display = 'none';
    
  }

  function addToCart() {
    const temp = document.querySelector('input[name="temp"]:checked');
    if (!temp) {
        alert('ìŒë£Œ ì˜¨ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    const tempVal = temp ? temp.value : '';

    const reqs = Array.from(document.querySelectorAll('.req-option:checked')).map(cb => cb.value);
    const adds = Array.from(document.querySelectorAll('.add-option:checked')).map(cb => cb.nextElementSibling.innerText);

    let extra = 0;
    document.querySelectorAll('.add-option:checked').forEach(cb => {
      extra += parseInt(cb.dataset.price || "0");
    });

    const finalPrice = selectedItem.price + extra;
    const optionsSummary = [tempVal, ...reqs, ...adds].filter(Boolean).join(', ');

    const li = document.createElement('li');
    li.dataset.name = selectedItem.name;
    li.dataset.price = finalPrice;
    li.dataset.count = 1;
    li.dataset.options = optionsSummary;
    li.innerHTML = `
        ${selectedItem.name} (${optionsSummary}) -
        <span class="item-qty">1</span>ê°œ
        <button class="qty-btn" onclick="changeQty(this, 1)">+</button>
        <button class="qty-btn" onclick="changeQty(this, -1)">-</button>
        <span class="item-subtotal">${finalPrice}ì›</span>
        <button class="delete-btn" onclick="deleteItem(this)">ì‚­ì œ</button>
    `;
    document.getElementById('cart-items').appendChild(li);

    updateTotal();
    closeOptionModal();
    playVoice("ë©”ë‰´ê°€ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤");
  }
  function deleteItem(btn) {
  btn.parentElement.remove();
  updateTotal();
  playVoice("í•´ë‹¹ ìŒë£Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤");
}
   function addDessert(name, price) {
    // li í•œ ì¤„ ìƒì„±
    const li = document.createElement('li');
    li.dataset.name = name;
    li.dataset.price = price;
    li.dataset.count = 1;
    li.dataset.options = "";   // ë””ì €íŠ¸ëŠ” ì˜µì…˜ ì—†ìŒ

    li.innerHTML = `
      ${name} -
      <span class="item-qty">1</span>ê°œ
      <button class="qty-btn" onclick="changeQty(this, 1)">+</button>
      <button class="qty-btn" onclick="changeQty(this, -1)">-</button>
      <span class="item-subtotal">${price}ì›</span>
      <button class="delete-btn" onclick="deleteItem(this)">ì‚­ì œ</button>
    `;

    document.getElementById('cart-items').appendChild(li);
    updateTotal();
    playVoice(name + "ê°€ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤");
  }

  
  
  function checkout() {
    
    const orderItems = [];
     document.querySelectorAll('#cart-items li').forEach(li => {
        orderItems.push({
            name: li.dataset.name,
            options: li.dataset.options,
            count: parseInt(li.dataset.count),
            price: parseInt(li.dataset.price)
        });
    });

    fetch("/payment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ order: orderItems })
    }).then(() => {
        window.location.href = "/payment";
    });
  }

  // 'ì—†ìŒ' ìë™ ì²˜ë¦¬ - ìš”ì²­ì‚¬í•­
  document.querySelectorAll('#requests .req-option').forEach(cb => {
    cb.addEventListener('change', () => {
      const all = [...document.querySelectorAll('#requests .req-option')];
      const none = all.find(e => e.value === "ì—†ìŒ");
      if (cb.value === "ì—†ìŒ" && cb.checked) {
        all.forEach(e => { if (e !== none) e.checked = false; });
      } else {
        none.checked = false;
      }
      if (!all.some(e => e.checked)) none.checked = true;
    });
  });

  // 'ì—†ìŒ' ìë™ ì²˜ë¦¬ - ì¶”ê°€ ì˜µì…˜
  document.querySelectorAll('#adds .add-option').forEach(cb => {
    cb.addEventListener('change', () => {
      const all = [...document.querySelectorAll('#adds .add-option')];
      const none = document.querySelector('#add1');
      if (cb === none && cb.checked) {
        all.forEach(e => { if (e !== none) e.checked = false; });
      } else {
        none.checked = false;
      }
      if (!all.some(e => e.checked)) none.checked = true;
    });
  });
    function changeQty(btn, delta) {
        const li = btn.parentElement;
        const qtySpan = li.querySelector('.item-qty');
        let count = parseInt(qtySpan.textContent) + delta;
        if (count <= 0) {
            li.remove();
            updateTotal();
            
            return;
        };
        qtySpan.textContent = count;
        li.dataset.count = count;
        li.querySelector('.item-subtotal').innerText = (parseInt(li.dataset.price) * count) + "ì›";
        updateTotal();
        if (delta > 0) {
          playVoice("ìˆ˜ëŸ‰ì´ ì¦ê°€í–ˆìŠµë‹ˆë‹¤");
        } else {
          playVoice("ìˆ˜ëŸ‰ì´ ê°ì†Œí–ˆìŠµë‹ˆë‹¤");
        }
        
        
    }

    function updateTotal() {
        let total = 0;
        document.querySelectorAll('#cart-items li').forEach(li => {
            total += parseInt(li.dataset.price) * parseInt(li.dataset.count);
        });
         document.getElementById('total').innerText = total;
    }

// ğŸ”Š ë©”ë‰´ í™”ë©´ ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹
function startVoiceOrder() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = 'ko-KR';
  recognition.interimResults = false;   // ì¤‘ê°„ ê²°ê³¼ X, í™•ì •ëœ ë¬¸ì¥ë§Œ
  recognition.continuous = true;        // ğŸ”¥ ê³„ì† ë“£ê¸° ëª¨ë“œ

  recognition.onresult = function(event) {
    const last = event.results[event.results.length - 1];
    const speechText = last[0].transcript.trim();
    console.log("ìŒì„± ì¸ì‹ ê²°ê³¼:", speechText);
    handleVoiceCommand(speechText);     // ì´ë¯¸ êµ¬í˜„í•œ ìŒì„± ì£¼ë¬¸ ë¡œì§ í˜¸ì¶œ
  };

  recognition.onerror = function(event) {
    console.log("ìŒì„± ì¸ì‹ ì˜¤ë¥˜:", event.error);
  };

  recognition.onend = function() {
    // ë§ˆì´í¬ê°€ ëŠì–´ì ¸ë„ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘í•´ì„œ 'ì‹¤ì‹œê°„' ìœ ì§€
    try { recognition.start(); } catch (e) {
      console.log("ìŒì„± ì¸ì‹ ì¬ì‹œì‘ ì‹¤íŒ¨:", e);
    }
  };

  try {
    recognition.start();
  } catch (e) {
    console.log("ìŒì„± ì¸ì‹ ì‹œì‘ ì‹¤íŒ¨:", e);
  }
}
// ğŸ”µ ë©”ë‰´ í˜ì´ì§€ ë¡œë“œë˜ë©´ ìë™ìœ¼ë¡œ ìŒì„± ì¸ì‹ ì‹œì‘
window.addEventListener("load", () => {
  startVoiceOrder();
});

function handleVoiceCommand(text) {
  console.log("handleVoiceCommand:", text);

  const noSpace = text.replace(/\s+/g, '');  // ê³µë°± ì œê±° ë²„ì „

  // ğŸ”¹ ìŒë£Œ / ë””ì €íŠ¸ ëª©ë¡
  const drinkNames = ['ì•„ë©”ë¦¬ì¹´ë…¸', 'ì¹´í˜ë¼ë–¼', 'ì´ˆì½”ë¼ë–¼', 'ë”¸ê¸°ë¼ë–¼', 'ë…¹ì°¨ë¼ë–¼', 'ë°”ë‹ë¼ë¼ë–¼', 'ì•„ì´ìŠ¤í‹°'];
  const dessertNames = ['ì¹˜ì¦ˆì¼€ì´í¬', 'ì™€í”Œ', 'ìƒŒë“œìœ„ì¹˜'];
  const menuNames = drinkNames.concat(dessertNames);

  // ğŸ”¹ ì¹´í˜ì¸ ê·¸ë£¹
  const caffeineYes = ['ì•„ë©”ë¦¬ì¹´ë…¸', 'ì¹´í˜ë¼ë–¼', 'ë°”ë‹ë¼ë¼ë–¼'];
  const caffeineNo  = [ 'ë…¹ì°¨ë¼ë–¼', 'ì´ˆì½”ë¼ë–¼', 'ì•„ì´ìŠ¤í‹°', 'ë”¸ê¸°ë¼ë–¼'];

  // ğŸ”¹ ê°€ê²©í‘œ (ìŒë£Œ + ë””ì €íŠ¸)
  const priceMap = {
    'ì•„ë©”ë¦¬ì¹´ë…¸': 2000,
    'ì¹´í˜ë¼ë–¼': 3000,
    'ì´ˆì½”ë¼ë–¼': 4500,
    'ë”¸ê¸°ë¼ë–¼': 5000,
    'ë…¹ì°¨ë¼ë–¼': 4000,
    'ë°”ë‹ë¼ë¼ë–¼': 3500,
    'ì•„ì´ìŠ¤í‹°': 3000,
    'ì¹˜ì¦ˆì¼€ì´í¬': 4500,
    'ì™€í”Œ': 4000,
    'ìƒŒë“œìœ„ì¹˜': 5000
  };

  // ------------------------------------
  // 0. "ê²°ì œí•˜ê¸° / ê²°ì œ" ëª…ë ¹ ë¨¼ì € ì²˜ë¦¬
  // ------------------------------------
  if (text.includes("ê²°ì œí•˜ê¸°") || text.includes("ê²°ì œ")) {
    const items = document.querySelectorAll('#cart-items li');
    if (items.length === 0) {
      playVoice("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ë©”ë‰´ë¥¼ ë¨¼ì € ë‹´ì•„ì£¼ì„¸ìš”.");
    } else {
      playVoice("ê²°ì œ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
      checkout();
    }
    return;
  }

  // ------------------------------------
  // 1. "ì¶”ì²œ" ëª…ë ¹ ì²˜ë¦¬
  // ------------------------------------
  if (text.includes("ì¶”ì²œ")) {
    let targetList = null;   // í›„ë³´ ë©”ë‰´ ë¦¬ìŠ¤íŠ¸
    let desc = "";           // ì•ˆë‚´ ë©˜íŠ¸ìš© í…ìŠ¤íŠ¸

    // 1) ì¹´í˜ì¸ ìˆëŠ” ìŒë£Œ ì¶”ì²œ
    if (text.includes("ì¹´í˜ì¸") && (text.includes("ìˆëŠ”") || text.includes("ìœ "))) {
      targetList = caffeineYes;
      desc = "ì¹´í˜ì¸ ìˆëŠ” ìŒë£Œ ì¤‘ì—ì„œ";
    }
    // 2) ì¹´í˜ì¸ ì—†ëŠ” ìŒë£Œ ì¶”ì²œ
    else if (text.includes("ì¹´í˜ì¸") && (text.includes("ì—†ëŠ”") || text.includes("ë¬´"))) {
      targetList = caffeineNo;
      desc = "ì¹´í˜ì¸ ì—†ëŠ” ìŒë£Œ ì¤‘ì—ì„œ";
    }
    // 3) ë””ì €íŠ¸ ì¶”ì²œ
    else if (text.includes("ë””ì €íŠ¸")) {
      targetList = dessertNames;
      desc = "ë””ì €íŠ¸ ì¤‘ì—ì„œ";
    }
    // 4) ê°€ê²© ê¸°ì¤€ ì¶”ì²œ (ì˜ˆ: 4000ì› ì´ˆê³¼/ë¯¸ë§Œ ìŒë£Œ ì¶”ì²œí•´ì¤˜)
    else if (text.includes("ì›") && text.includes("ìŒë£Œ")) {
      // ìˆ«ì ì¶”ì¶œ (ì˜ˆ: 4000ì›)
      let threshold = null;
      const numMatch = text.match(/(\d+)\s*ì›/);
      if (numMatch) {
        threshold = parseInt(numMatch[1], 10);
      } else if (text.includes("4ì²œ") || text.includes("ì‚¬ì²œ")) {
        threshold = 4000;
      }

      if (threshold !== null) {
        // ì´ˆê³¼ / ì´ìƒ / ë¯¸ë§Œ / ì´í•˜ íŒë³„
        let comparator = null; // 'gt' or 'lt'
        if (text.includes("ì´ˆê³¼") || text.includes("ì´ìƒ")) {
          comparator = 'gt';
          desc = `${threshold}ì› ì´ìƒ ìŒë£Œ ì¤‘ì—ì„œ`;
        } else if (text.includes("ë¯¸ë§Œ") || text.includes("ì´í•˜")) {
          comparator = 'lt';
          desc = `${threshold}ì› ë¯¸ë§Œ ìŒë£Œ ì¤‘ì—ì„œ`;
        }

        if (comparator) {
          targetList = drinkNames.filter(name => {
            const price = priceMap[name];
            if (comparator === 'gt') return price >= threshold;  // ì´ìƒ/ì´ˆê³¼ ìª½
            if (comparator === 'lt') return price <= threshold;  // ì´í•˜/ë¯¸ë§Œ ìª½
            return false;
          });
        }
      }
    }

    // í›„ë³´ê°€ ì—†ìœ¼ë©´ ì¡°ìš©íˆ ì¢…ë£Œ
    if (!targetList || targetList.length === 0) {
      console.log("ì¶”ì²œ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤:", text);
      playVoice("ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    // ë¬´ì‘ìœ„ë¡œ í•˜ë‚˜ ì„ íƒ
    const pick = targetList[Math.floor(Math.random() * targetList.length)];
    const isDessert = dessertNames.includes(pick);

    // ì¶”ì²œì€ ê¸°ë³¸ 1ê°œ, ìŒë£ŒëŠ” ICE ê¸°ë³¸ ì˜¨ë„
    let temp = '';
    if (!isDessert) {
      temp = 'ICE';
    }

    const basePrice = priceMap[pick];
    const finalPrice = basePrice;
    const optionsSummary = [temp].filter(Boolean).join(', ');
    const optionText = optionsSummary ? ` (${optionsSummary})` : '';

    const li = document.createElement('li');
    li.dataset.name = pick;
    li.dataset.price = finalPrice;
    li.dataset.count = 1;
    li.dataset.options = optionsSummary;
    li.innerHTML = `
      ${pick}${optionText} -
      <span class="item-qty">1</span>ê°œ
      <button class="qty-btn" onclick="changeQty(this, 1)">+</button>
      <button class="qty-btn" onclick="changeQty(this, -1)">-</button>
      <span class="item-subtotal">${finalPrice}ì›</span>
      <button class="delete-btn" onclick="deleteItem(this)">ì‚­ì œ</button>
    `;
    document.getElementById('cart-items').appendChild(li);
    updateTotal();

    playVoice(`${desc} ${pick}ë¥¼ ì¶”ì²œí•˜ì—¬ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤.`);
    return;  // ì¶”ì²œ ì²˜ë¦¬ ë, ì•„ë˜ ì¼ë°˜ ì£¼ë¬¸ì€ íƒ€ì§€ ì•ŠìŒ
  }

  // ------------------------------------
  // 2. ì¼ë°˜ ì£¼ë¬¸ ì²˜ë¦¬ (ê¸°ì¡´ ë¡œì§)
  // ------------------------------------
  const options = {
    temp: ['ì•„ì´ìŠ¤', 'í•«'],
    add: ['ìƒ· ì¶”ê°€', 'íœ˜í•‘ ì¶”ê°€', 'ë°”ë‹ë¼ ì‹œëŸ½'],
    req: ['ì–¼ìŒ ì ê²Œ', 'ì—°í•˜ê²Œ']
  };

  // 1) ë©”ë‰´ëª… ì°¾ê¸°
  let foundMenu = menuNames.find(name => text.includes(name));
  if (!foundMenu) {
    console.log("ë©”ë‰´ëª…ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:", text);

    const now = Date.now();
    if (now - lastVoiceErrorTime > 3000) {
      // í•„ìš”í•˜ë©´ ì•ˆë‚´ ë©˜íŠ¸ ì¼œê¸°
      // playVoice("ì£„ì†¡í•©ë‹ˆë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ë©”ë‰´ ì´ë¦„ê³¼ ì˜¨ë„ë¥¼ ë§ì”€í•´ ì£¼ì„¸ìš”.");
      lastVoiceErrorTime = now;
    }
    return;
  }

  const isDessertOrder = dessertNames.includes(foundMenu);

  // 2) ì˜¨ë„ ì²˜ë¦¬ (ë””ì €íŠ¸ëŠ” ì˜¨ë„ X)
  let tempOrder = '';
  if (!isDessertOrder) {
    tempOrder = text.includes('ì•„ì´ìŠ¤')
      ? 'ICE'
      : (text.includes('í•«') ? 'HOT' : '');

    if (!tempOrder) {
      const now = Date.now();
      if (now - lastVoiceErrorTime > 3000) {
        playVoice("ì•„ì´ìŠ¤ ë˜ëŠ” í•«ì„ í•¨ê»˜ ë§ì”€í•´ ì£¼ì„¸ìš”.");
        lastVoiceErrorTime = now;
      }
      return; // ì˜¨ë„ ì—†ìœ¼ë©´ ìŒë£Œ ì£¼ë¬¸ì€ ë„£ì§€ ì•ŠìŒ
    }
  }

  // 3) ìš”ì²­ì‚¬í•­ / ì¶”ê°€ ì˜µì…˜ (ë””ì €íŠ¸ëŠ” ì˜µì…˜ ì—†ìŒ)
  let reqs = [];
  let adds = [];
  if (!isDessertOrder) {
    reqs = options.req.filter(opt => text.includes(opt));
    adds = options.add.filter(opt => text.includes(opt));
  }

  // 4) ì” ìˆ˜ íŒŒì‹±
  let count = 1;
  if (noSpace.includes('ë‘ì”') || noSpace.includes('2ì”')) {
    count = 2;
  } else if (noSpace.includes('ì„¸ì”') || noSpace.includes('3ì”')) {
    count = 3;
  } else if (noSpace.includes('ë„¤ì”') || noSpace.includes('4ì”')) {
    count = 4;
  } else if (noSpace.includes('ë‹¤ì„¯ì”') || noSpace.includes('5ì”')) {
    count = 5;
  } else if (noSpace.includes('í•œì”') || noSpace.includes('1ì”')) {
    count = 1;
  }

  // 5) ê°€ê²© ê³„ì‚°
  let basePriceOrder = priceMap[foundMenu];
  let extra = adds.length * 500;
  let finalPriceOrder = basePriceOrder + extra;

  const optionsSummaryOrder = [tempOrder, ...reqs, ...adds].filter(Boolean).join(', ');
  const optionTextOrder = optionsSummaryOrder ? ` (${optionsSummaryOrder})` : '';

  const li = document.createElement('li');
  li.dataset.name = foundMenu;
  li.dataset.price = finalPriceOrder;
  li.dataset.count = count;
  li.dataset.options = optionsSummaryOrder;
  li.innerHTML = `
      ${foundMenu}${optionTextOrder} -
      <span class="item-qty">${count}</span>ê°œ
      <button class="qty-btn" onclick="changeQty(this, 1)">+</button>
      <button class="qty-btn" onclick="changeQty(this, -1)">-</button>
      <span class="item-subtotal">${finalPriceOrder * count}ì›</span>
      <button class="delete-btn" onclick="this.parentElement.remove(); updateTotal();">ì‚­ì œ</button>
  `;
  document.getElementById('cart-items').appendChild(li);
  updateTotal();

  playVoice(`${foundMenu} ${count}ì”ì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤`);
}



  

</script>

<script>
  function playVoice(text) {
    const audio = new Audio(`/speak/${encodeURIComponent(text)}`);
    audio.play();
  }
  
document.querySelectorAll('input[name="temp"]').forEach(radio => {
  radio.addEventListener('change', () => {
    const label = document.querySelector(`label[for="${radio.id}"]`);
    if (label) playVoice(label.textContent);
  });
});


document.querySelectorAll('.req-option').forEach(cb => {
  cb.addEventListener('change', () => {
    if (cb.checked) {
      const label = document.querySelector(`label[for="${cb.id}"]`);
      if (label) playVoice(label.textContent);
    }
  });
});


document.querySelectorAll('.add-option').forEach(cb => {
  cb.addEventListener('change', () => {
    if (cb.checked) {
      const label = document.querySelector(`label[for="${cb.id}"]`);
      if (label) playVoice(label.textContent);
    }
  });
});

</script>

</body>
</html>